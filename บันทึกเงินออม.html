<div class="bg-white p-5 rounded-3xl shadow-sm border mt-4">
            <h3 class="font-bold text-sm text-gray-700 mb-3">üïí ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
            <div id="history-list" class="space-y-2 max-h-60 overflow-y-auto">
                <p class="text-center text-gray-400 text-xs py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
            </div>
        </div>

    </div>

    <script>
        // *** (‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Supabase ‡πÅ‡∏•‡∏∞ Auth ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) ***

        // ‡∏õ‡∏£‡∏±‡∏ö‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô loadData ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏î‡πâ‡∏ß‡∏¢
        async function loadData() {
            // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏î‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏õ‡πÄ‡∏Å‡πà‡∏≤ (order by created_at descending)
            const { data: trans } = await _supabase.from('transactions').select('*').order('created_at', { ascending: false });
            
            let saving = 0, income = 0, expense = 0;
            const historyList = document.getElementById('history-list');
            historyList.innerHTML = ''; // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡πà‡∏≤
            
            if(trans && trans.length > 0) {
                trans.forEach(t => {
                    if(t.type === 'saving') saving += t.amount;
                    if(t.type === 'income') income += t.amount;
                    if(t.type === 'expense') expense += t.amount;

                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                    const date = new Date(t.created_at).toLocaleString('th-TH', { 
                        day: '2-digit', month: 'short', hour: '2-digit', minute: '2-digit' 
                    });
                    
                    let typeText = '', typeColor = '';
                    if(t.type === 'saving') { typeText = '‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô'; typeColor = 'text-blue-600'; }
                    if(t.type === 'income') { typeText = '‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö'; typeColor = 'text-green-600'; }
                    if(t.type === 'expense') { typeText = '‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢'; typeColor = 'text-red-600'; }

                    historyList.innerHTML += `
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-2xl border-b border-gray-100">
                            <div>
                                <p class="text-xs font-bold ${typeColor}">${typeText}</p>
                                <p class="text-[10px] text-gray-400">${date}</p>
                            </div>
                            <p class="font-bold ${typeColor}">${t.type === 'expense' ? '-' : '+'}${t.amount.toLocaleString()}</p>
                        </div>
                    `;
                });
            } else {
                historyList.innerHTML = '<p class="text-center text-gray-400 text-xs py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>';
            }

            document.getElementById('sum-saving').innerText = `‡∏ø${saving.toLocaleString()}`;
            document.getElementById('sum-net').innerText = `‡∏ø${(income - expense).toLocaleString()}`;

            // (‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏á‡∏ß‡∏î‡∏´‡∏ô‡∏µ‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°...)
            loadDebtData();
        }
        
        // ‡πÅ‡∏¢‡∏Å‡∏™‡πà‡∏ß‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡πÑ‡∏°‡πà‡∏á‡∏á
        async function loadDebtData() {
            const { data: debts } = await _supabase.from('debts').select('*');
            const grid = document.getElementById('debt-grid');
            grid.innerHTML = '';
            let paidCount = 0;
            for(let i=1; i<=50; i++) {
                const isPaid = const SB_URL = 'https://outuhvsmvmbseccdfvwb.supabase.co'; //const SB_KEY = 'sb_publishable_WKuvVWnMiDtPmgQXSzP_xA_lWOdOUyK';              //debts?.find(d => d.installment_no === i)?.is_paid;
                if(isPaid) paidCount++;
                grid.innerHTML += `
                    <div onclick="toggleDebt(${i}, ${isPaid})" 
                         class="aspect-square flex items-center justify-center rounded-xl font-bold cursor-pointer text-[10px] transition
                         ${isPaid ? 'bg-indigo-600 text-white shadow-md' : 'bg-gray-100 text-gray-400 border border-gray-200'}">
                        ${i}
                    </div>`;
            }
            document.getElementById('debt-status').innerText = `${paidCount}/50 ‡∏á‡∏ß‡∏î`;
        }
    </script>
